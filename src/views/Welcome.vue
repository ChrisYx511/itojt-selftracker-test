<template>
    <span class="bg" :style="'background-image: url(' + getImageUrl(randomImage).toString() + ')'"></span>
    <v-app>
        <v-app-bar>
            <v-img class="mx-4" src="@/assets/CdtCompass.png" max-height="40" max-width="40" contain>
            </v-img>
            <v-app-bar-title>
                CadetCompass | AtlasCadets (6 - Inspections // α)
            </v-app-bar-title>
        </v-app-bar>
        <v-main>
            <v-container class="align-center fill-height">
                <v-row>
                    <v-col cols="12" md="6">
                        <v-sheet :class="paddingClass" >
                            <div :class="titleClass">Welcome to <div class="font-weight-medium" >CadetCompass</div></div><br>
                            <div :class="titleClass">Bienvenue à <br><div class="font-weight-medium" >AtlasCadets</div></div><br>
                            <v-form ref="loginForm" @submit.prevent>
                                <v-text-field v-model="userName" :rules="userNameValidation" placeholder="Username | Nom d'utilisateur">
                                </v-text-field>
                                <v-btn type="submit" block class="mt-2" @click="submitLoginForm()">Login | Se Connecter</v-btn>
                            </v-form>
                            <!--<v-img class="align-center button mt-6 rounded-lg" src="@/assets/c365en.svg" max-width="300" @click="handleLogin()">
                            </v-img>-->
                        </v-sheet>
                    </v-col>
                    <v-col></v-col>
                </v-row>
            </v-container>
        </v-main>
        <v-overlay v-model="overlay" :persistent="true" class="align-center justify-center">
            <v-sheet class="pa-6 rounded-lg">
                <div>Please use the pop-up window to continue.</div><br>
                <div>Veuillez vous référer à la fenêtre contextuelle pour continuer.</div>
            </v-sheet>
        </v-overlay>
    </v-app>
</template>

<script setup>
import { ref, computed } from 'vue';
import { auth } from '@/stores/auth'
import { useRouter } from 'vue-router';
import { useDisplay } from 'vuetify/lib/framework.mjs';
import { onMounted } from 'vue';
import { useI18n } from 'vue-i18n';

const { locale } = useI18n()

if (localStorage.getItem("lang") !== null | localStorage.getItem("lang") !== '') {
    locale.value = localStorage.getItem("lang")
}


const { lgAndUp } = useDisplay()
console.log(auth.initialized)
const paddingClass = computed(() => {
    if (lgAndUp.value) {
        return 'pa-16 rounded-lg'
    } else {
        return 'pa-10 rounded-lg'
    }
})

const titleClass = computed(() => {
    if (lgAndUp.value) {
        return 'text-h3'
    } else {
        return 'text-h4'
    }
})

const router = useRouter()
let overlay = ref(false)
console.log(auth.account)

function getImageUrl(imgName) {
    return new URL(`../assets/loginBanners/${imgName}.jpg`, import.meta.url).href
}
console.log(getImageUrl('img1').toString())

const images = ['img1', 'img2', 'img3', 'img4', 'img5', 'img6', 'img7']

const randomImage = computed( () => {
    return images[Math.floor(Math.random() * 6)]
}
)
const loginForm = ref(null)
const userName = ref("")
const userNameValidation = ref([
    value => {
        if (value) return true
        return "Enter a username | Entrez un nom d'utilisateur"
    }
])
async function submitLoginForm() {
    const {valid} = await loginForm.value.validate()
    if (valid) {
        handleLogin(userName.value)
    }
}
function handleLogin(userName) {
    overlay.value = true
    auth.login(userName.trim() + "@chrisyx511outlook.onmicrosoft.com").then(() => {overlay.value = false; router.push('/app')}, () => {overlay.value = false;})
}
onMounted(() => {
    auth.initialize().then((accountInfo) => {
        if (accountInfo) {
                router.push('/app')
            }
    })
})
</script>

<style scoped>
.loginButton {
    border-radius: 10px;
}
.button:hover {
    cursor: pointer;
}
.bg {
    width: 100vw;
    overflow: hidden;
    height: 100vh;
    position: absolute;
    top: 0;
    left: 0;
    background-color: white;
    background-repeat: no-repeat;
    background-position-x: center;
    background-position-y: 20%;
    background-size: cover;
  }

  
  #app {
    overflow: hidden;
    height: 100vh;
  }
</style>